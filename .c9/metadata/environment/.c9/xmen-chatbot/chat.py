{"changed":true,"filter":false,"title":"chat.py","tooltip":"/.c9/xmen-chatbot/chat.py","value":"import streamlit as st\nimport time\nfrom PIL import Image\nimport os\n\nst.title(\"ğŸ’¬ AI SERVICE\")\n\n\nimage_path = '/home/ubuntu/environment/.c9/xmen-chatbot/BAGGAGE_20240307_093706_140005_SUPERVISOR_A_ud.jpg'\n\n\ndetection_results = {\n    \"index\": \"dsfdfsdf\",\n    \"UserID\": \"001\",\n    \"s3\": \"....\",\n    \"objects\": [\n        {\n            \"type\": \"SSD\",\n            \"position\": [2, 0, 0, 1],\n            \"amount\": 3\n        },\n        {\n            \"type\": \"USB\",\n            \"position\": [0, 0, 1, 0],\n            \"amount\": 1\n        }\n    ]\n}\n\n\n# AWS \ns3 = boto3.client('s3')\ndynamodb = boto3.client('dynamodb')\nsagemaker_runtime = boto3.client('runtime.sagemaker')\n\ndef get_position_text(positions):\n    position_texts = []\n    if positions[0] > 0:\n        position_texts.append(f\"ì™¼ìª½ ìƒë‹¨ì— {positions[0]}ê°œ\")\n    if positions[1] > 0:\n        position_texts.append(f\"ì˜¤ë¥¸ìª½ ìƒë‹¨ì— {positions[1]}ê°œ\")\n    if positions[2] > 0:\n        position_texts.append(f\"ì™¼ìª½ í•˜ë‹¨ì— {positions[2]}ê°œ\")\n    if positions[3] > 0:\n        position_texts.append(f\"ì˜¤ë¥¸ìª½ í•˜ë‹¨ì— {positions[3]}ê°œ\")\n    return \", \".join(position_texts)\n\n# íƒì§€ëì„ ë•Œ\ndef generate_detection_message(detection_results):\n    total_objects = sum([obj[\"amount\"] for obj in detection_results[\"objects\"]])\n    detection_message = f\"ì´ {total_objects}ê°œì˜ ë¬¼í’ˆì´ íƒì§€ë˜ì—ˆìŠµë‹ˆë‹¤.\\n\"\n    for obj in detection_results[\"objects\"]:\n        detection_message += f\"<br>{obj['type']}ê°€ {obj['amount']}ê°œ íƒì§€ë˜ì—ˆìŠµë‹ˆë‹¤.\\n\"\n        position_text = get_position_text(obj[\"position\"])\n        detection_message += f\"<br>{obj['type']}ëŠ” {position_text}ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤.\\n\"\n    return detection_message\n\n# íƒì§€ ì•ˆ ëì„ ë•Œ\ndef handle_no_detection():\n    st.session_state.messages.append({\"role\": \"user\", \"content\": \"No Detection\"})\n    st.session_state.messages.append(\n        {\"role\": \"assistant\", \"content\": \"ë¬¼ì²´ê°€ ì œëŒ€ë¡œ íƒì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê°€ë°©ì„ í”ë“¤ì–´ì„œ ë‹¤ì‹œ ì˜¬ë ¤ì£¼ì„¸ìš”.\"}\n    )\n    st.chat_message(\"assistant\").write(\"ë¬¼ì²´ê°€ ì œëŒ€ë¡œ íƒì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê°€ë°©ì„ í”ë“¤ì–´ì„œ ë‹¤ì‹œ ì˜¬ë ¤ì£¼ì„¸ìš”.\")\n    st.session_state.stage = 3\n    st.rerun()\n\n# íƒì§€ ëì„ ë•Œ\ndef handle_objects_detected():\n    st.session_state.messages.append({\"role\": \"user\", \"content\": \"Objects Detected\"})\n    st.session_state.messages.append({\"role\": \"assistant\", \"content\": \"ìŠ¤ìº”ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. íƒì§€ëœ ë¬¼ì²´ë¥¼ í™•ì¸í•©ë‹ˆë‹¤...\"})\n    st.chat_message(\"assistant\").write(\"ìŠ¤ìº”ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. íƒì§€ëœ ë¬¼ì²´ë¥¼ í™•ì¸í•©ë‹ˆë‹¤...\")\n    with st.spinner(\"í™•ì¸ ì¤‘...\"):\n        time.sleep(2)\n\n    detection_message = generate_detection_message(detection_results)\n    st.session_state.messages.append({\"role\": \"assistant\", \"content\": detection_message})\n    st.chat_message(\"assistant\").write(detection_message)\n\n    st.session_state.show_image = True\n    st.session_state.stage = 3\n    st.rerun()\n\n# ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”\nif \"stage\" not in st.session_state:\n    st.session_state.stage = 0\nif \"messages\" not in st.session_state:\n    st.session_state.messages = [\n        {\"role\": \"assistant\", \"content\": \"ì•ˆë…•í•˜ì„¸ìš”.<br>ê°€ë°©ì„ ëˆ•í˜€ì„œ ì˜¬ë ¤ì£¼ì„¸ìš”.\"}\n    ]\nif \"uploaded_image\" not in st.session_state:\n    st.session_state.uploaded_image = None\nif \"show_image\" not in st.session_state:\n    st.session_state.show_image = False\n\n# ë©”ì‹œì§€ í‘œì‹œ\nfor msg in st.session_state.messages:\n    st.chat_message(msg[\"role\"]).markdown(msg[\"content\"], unsafe_allow_html=True)\n\n\nuploaded_file = image_path\n\n# ì—…ë¡œë“œëœ ì´ë¯¸ì§€ë¥¼ í™”ë©´ì— í‘œì‹œ\nif st.session_state.stage == 0:\n    if uploaded_file and os.path.exists(uploaded_file):\n        st.session_state.uploaded_image = uploaded_file\n\n    if st.button('Start Scanning'):\n        st.session_state.messages.append({\"role\": \"assistant\", \"content\": \"ìŠ¤ìº”ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...\"})\n        st.chat_message(\"assistant\").write(\"ìŠ¤ìº”ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...\")\n        with st.spinner(\"ìŠ¤ìº” ì¤‘...\"):\n            time.sleep(5)\n        st.session_state.stage = 1\n        st.rerun()\n    elif not os.path.exists(uploaded_file):\n        st.error(f\"Error: The file at {uploaded_file} does not exist.\")\n\nelif st.session_state.stage == 1:\n    st.session_state.messages.append({\"role\": \"assistant\", \"content\": \"ìŠ¤ìº”ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.\"})\n    st.chat_message(\"assistant\").write(\"ìŠ¤ìº”ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.\")\n    st.session_state.stage = 2\n    st.rerun()\n\nelif st.session_state.stage == 2:\n    if st.button('No Detection'):\n        handle_no_detection()\n\n    if st.button('Objects Detected'):\n        handle_objects_detected()\n\nelif st.session_state.stage == 3:\n    if st.session_state.show_image:\n        if os.path.exists(st.session_state.uploaded_image):\n            st.image(st.session_state.uploaded_image, caption='Detected Objects', use_column_width=True)\n        else:\n            st.error(f\"Error: The file at {st.session_state.uploaded_image} does not exist.\")\n\n    if st.button('Retry Scanning'):\n        st.session_state.messages.append({\"role\": \"user\", \"content\": \"Retry Scanning\"})\n        st.session_state.messages.append({\"role\": \"assistant\", \"content\": \"ë‹¤ì‹œ ìŠ¤ìº”ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...\"})\n        st.chat_message(\"assistant\").write(\"ë‹¤ì‹œ ìŠ¤ìº”ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...\")\n        with st.spinner(\"ìŠ¤ìº” ì¤‘...\"):\n            time.sleep(5)\n        st.session_state.stage = 1\n        st.experimental_rerun()\n\n    if st.button('Complete'):\n        st.session_state.stage = 4\n        st.rerun()\n\nelif st.session_state.stage == 4:\n    st.session_state.messages.append({\"role\": \"assistant\", \"content\": \"í™•ì¸ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.\"})\n    st.chat_message(\"assistant\").write(\"í™•ì¸ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.\")\n    if st.button('Retry Scanning'):\n        st.session_state.messages.append({\"role\": \"user\", \"content\": \"Retry Scanning\"})\n        st.session_state.messages.append({\"role\": \"assistant\", \"content\": \"ë‹¤ì‹œ ìŠ¤ìº”ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...\"})\n        st.chat_message(\"assistant\").write(\"ë‹¤ì‹œ ìŠ¤ìº”ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...\")\n        with st.spinner(\"ìŠ¤ìº” ì¤‘...\"):\n            time.sleep(5)\n        st.session_state.stage = 1\n        st.experimental_rerun()\n    if st.button('Complete'):\n        st.session_state.messages.append({\"role\": \"user\", \"content\": \"Complete\"})\n        st.session_state.messages.append({\"role\": \"assistant\", \"content\": \"í™•ì¸ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.\"})\n        st.chat_message(\"assistant\").write(\"í™•ì¸ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.\")\n\ndef main():\n    pass\n\nif __name__ == '__main__':\n    main()\n","undoManager":{"mark":-1,"position":-1,"stack":[]},"ace":{"folds":[],"scrolltop":1615,"scrollleft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":0,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":99,"state":"start","mode":"ace/mode/python"}},"timestamp":1716472591217}