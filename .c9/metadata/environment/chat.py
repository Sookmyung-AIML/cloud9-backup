{"filter":false,"title":"chat.py","tooltip":"/chat.py","undoManager":{"mark":0,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":165,"column":10},"action":"insert","lines":["import streamlit as st","import time","from PIL import Image","import os","","st.title(\"ğŸ’¬ AI SERVICE\")","","# ì´ë¯¸ì§€ ê²½ë¡œ ì„¤ì • (ì ˆëŒ€ ê²½ë¡œ)","image_path = '/home/ubuntu/environment/.c9/xmen-chatbot/2024032609093515_aug0_lr.png'","","detection_results = {","    \"index\": \"dsfdfsdf\",","    \"UserID\": \"001\",","    \"s3\": \"....\",","    \"objects\": [","        {","            \"type\": \"SSD\",","            \"position\": [2, 0, 0, 1],","            \"amount\": 3","        },","        {","            \"type\": \"USB\",","            \"position\": [0, 0, 1, 0],","            \"amount\": 1","        }","    ]","}","","# íƒì§€ ìœ„ì¹˜ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜","def get_position_text(positions):","    position_texts = []","    if positions[0] > 0:","        position_texts.append(f\"ì™¼ìª½ ìƒë‹¨ì— {positions[0]}ê°œ\")","    if positions[1] > 0:","        position_texts.append(f\"ì˜¤ë¥¸ìª½ ìƒë‹¨ì— {positions[1]}ê°œ\")","    if positions[2] > 0:","        position_texts.append(f\"ì™¼ìª½ í•˜ë‹¨ì— {positions[2]}ê°œ\")","    if positions[3] > 0:","        position_texts.append(f\"ì˜¤ë¥¸ìª½ í•˜ë‹¨ì— {positions[3]}ê°œ\")","    return \", \".join(position_texts)","","# íƒì§€ëœ ë¬¼ì²´ ë©”ì‹œì§€ë¥¼ ìƒì„±","def generate_detection_message(detection_results):","    total_objects = sum([obj[\"amount\"] for obj in detection_results[\"objects\"]])","    detection_message = f\"ì´ {total_objects}ê°œì˜ ë¬¼í’ˆì´ íƒì§€ë˜ì—ˆìŠµë‹ˆë‹¤.\\n\"","    for obj in detection_results[\"objects\"]:","        detection_message += f\"<br>{obj['type']}ê°€ {obj['amount']}ê°œ íƒì§€ë˜ì—ˆìŠµë‹ˆë‹¤.\\n\"","        position_text = get_position_text(obj[\"position\"])","        detection_message += f\"<br>{obj['type']}ëŠ” {position_text}ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤.\\n\"","    return detection_message","","# íƒì§€ ì•ˆ ëì„ ë•Œ","def handle_no_detection():","    st.session_state.messages.append({\"role\": \"user\", \"content\": \"No Detection\"})","    st.session_state.messages.append(","        {\"role\": \"assistant\", \"content\": \"ë¬¼ì²´ê°€ ì œëŒ€ë¡œ íƒì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê°€ë°©ì„ í”ë“¤ì–´ì„œ ë‹¤ì‹œ ì˜¬ë ¤ì£¼ì„¸ìš”.\"}","    )","    st.chat_message(\"assistant\").write(\"ë¬¼ì²´ê°€ ì œëŒ€ë¡œ íƒì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê°€ë°©ì„ í”ë“¤ì–´ì„œ ë‹¤ì‹œ ì˜¬ë ¤ì£¼ì„¸ìš”.\")","    st.session_state.stage = 3","    st.rerun()","","# íƒì§€ ëì„ ë•Œ","def handle_objects_detected():","    st.session_state.messages.append({\"role\": \"user\", \"content\": \"Objects Detected\"})","    st.session_state.messages.append({\"role\": \"assistant\", \"content\": \"ìŠ¤ìº”ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. íƒì§€ëœ ë¬¼ì²´ë¥¼ í™•ì¸í•©ë‹ˆë‹¤...\"})","    st.chat_message(\"assistant\").write(\"ìŠ¤ìº”ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. íƒì§€ëœ ë¬¼ì²´ë¥¼ í™•ì¸í•©ë‹ˆë‹¤...\")","    with st.spinner(\"í™•ì¸ ì¤‘...\"):","        time.sleep(2)","","    detection_message = generate_detection_message(detection_results)","    st.session_state.messages.append({\"role\": \"assistant\", \"content\": detection_message})","    st.chat_message(\"assistant\").write(detection_message)","","    # íƒì§€ëœ ì´ë¯¸ì§€ í‘œì‹œë¥¼ ìœ„í•œ í”Œë˜ê·¸ ì„¤ì •","    st.session_state.show_image = True","    st.session_state.stage = 3","    st.rerun()","","# ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”","if \"stage\" not in st.session_state:","    st.session_state.stage = 0","if \"messages\" not in st.session_state:","    st.session_state.messages = [","        {\"role\": \"assistant\", \"content\": \"ì•ˆë…•í•˜ì„¸ìš”.<br>ê°€ë°©ì„ ëˆ•í˜€ì„œ ì˜¬ë ¤ì£¼ì„¸ìš”.\"}","    ]","if \"uploaded_image\" not in st.session_state:","    st.session_state.uploaded_image = None","if \"show_image\" not in st.session_state:","    st.session_state.show_image = False","","# ë©”ì‹œì§€ í‘œì‹œ","for msg in st.session_state.messages:","    st.chat_message(msg[\"role\"]).markdown(msg[\"content\"], unsafe_allow_html=True)","","# ì´ë¯¸ì§€ ê²½ë¡œ ì„¤ì •","uploaded_file = image_path","","# ì—…ë¡œë“œëœ ì´ë¯¸ì§€ë¥¼ í™”ë©´ì— í‘œì‹œ","if st.session_state.stage == 0:","    if uploaded_file and os.path.exists(uploaded_file):","        st.session_state.uploaded_image = uploaded_file","","    if st.button('Start Scanning'):","        st.session_state.messages.append({\"role\": \"assistant\", \"content\": \"ìŠ¤ìº”ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...\"})","        st.chat_message(\"assistant\").write(\"ìŠ¤ìº”ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...\")","        with st.spinner(\"ìŠ¤ìº” ì¤‘...\"):","            time.sleep(5)","        st.session_state.stage = 1","        st.rerun()","    elif not os.path.exists(uploaded_file):","        st.error(f\"Error: The file at {uploaded_file} does not exist.\")","","elif st.session_state.stage == 1:","    st.session_state.messages.append({\"role\": \"assistant\", \"content\": \"ìŠ¤ìº”ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.\"})","    st.chat_message(\"assistant\").write(\"ìŠ¤ìº”ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.\")","    st.session_state.stage = 2","    st.rerun()","","elif st.session_state.stage == 2:","    if st.button('No Detection'):","        handle_no_detection()","","    if st.button('Objects Detected'):","        handle_objects_detected()","","elif st.session_state.stage == 3:","    if st.session_state.show_image:","        if os.path.exists(st.session_state.uploaded_image):","            st.image(st.session_state.uploaded_image, caption='Detected Objects', use_column_width=True)","        else:","            st.error(f\"Error: The file at {st.session_state.uploaded_image} does not exist.\")","","    if st.button('Retry Scanning'):","        st.session_state.messages.append({\"role\": \"user\", \"content\": \"Retry Scanning\"})","        st.session_state.messages.append({\"role\": \"assistant\", \"content\": \"ë‹¤ì‹œ ìŠ¤ìº”ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...\"})","        st.chat_message(\"assistant\").write(\"ë‹¤ì‹œ ìŠ¤ìº”ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...\")","        with st.spinner(\"ìŠ¤ìº” ì¤‘...\"):","            time.sleep(5)","        st.session_state.stage = 1","        st.experimental_rerun()","","    if st.button('Complete'):","        st.session_state.stage = 4","        st.rerun()","","elif st.session_state.stage == 4:","    st.session_state.messages.append({\"role\": \"assistant\", \"content\": \"í™•ì¸ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.\"})","    st.chat_message(\"assistant\").write(\"í™•ì¸ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.\")","    if st.button('Retry Scanning'):","        st.session_state.messages.append({\"role\": \"user\", \"content\": \"Retry Scanning\"})","        st.session_state.messages.append({\"role\": \"assistant\", \"content\": \"ë‹¤ì‹œ ìŠ¤ìº”ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...\"})","        st.chat_message(\"assistant\").write(\"ë‹¤ì‹œ ìŠ¤ìº”ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...\")","        with st.spinner(\"ìŠ¤ìº” ì¤‘...\"):","            time.sleep(5)","        st.session_state.stage = 1","        st.experimental_rerun()","    if st.button('Complete'):","        st.session_state.messages.append({\"role\": \"user\", \"content\": \"Complete\"})","        st.session_state.messages.append({\"role\": \"assistant\", \"content\": \"í™•ì¸ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.\"})","        st.chat_message(\"assistant\").write(\"í™•ì¸ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.\")","","def main():","    pass","","if __name__ == '__main__':","    main()"],"id":1}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":99,"column":17},"end":{"row":99,"column":17},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1716353520578,"hash":"e7b06831276b172c237aa389169f8b14ab2dbee8"}