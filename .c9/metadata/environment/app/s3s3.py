{"changed":true,"filter":false,"title":"s3s3.py","tooltip":"/app/s3s3.py","value":"import boto3\nimport cv2\nimport os\n\nclass S3: \n    def __init__(self):\n        # AWS 자격 증명을 환경 변수로 설정\n        self.s3_client = boto3.client(\n            's3',\n            aws_access_key_id=os.getenv('AWS_ACCESS_KEY_ID'),\n            aws_secret_access_key=os.getenv('AWS_SECRET_ACCESS_KEY')\n        )\n        \n        # SageMaker 엔드포인트 URL 설정\n        self.sagemaker_endpoint = 'YOUR_SAGEMAKER_ENDPOINT_NAME'\n\n    def stream_s3_file(self, bucket_name, file_key):\n        # S3 객체를 스트리밍 방식으로 읽기\n        s3_object = self.s3_client.get_object(Bucket=bucket_name, Key=file_key)\n        return s3_object['Body']\n    \n    def capture_frames(video_path, output_dir, capture_times):\n        # 비디오 파일 열기\n        cap = cv2.VideoCapture(video_path)\n        if not cap.isOpened():\n            print(\"비디오 파일을 열 수 없습니다.\")\n            return\n        \n        # 캡처할 시간 지정 (초)\n        capture_seconds = capture_times\n        \n        # 이미지를 저장할 디렉토리 생성\n        os.makedirs(output_dir, exist_ok=True)\n        \n        # 캡처된 시간과 프레임 번호 저장\n        capture_frames = [(int(cap.get(cv2.CAP_PROP_FPS) * sec), sec) for sec in capture_seconds]\n        \n        # 프레임 캡처 및 이미지 저장\n        frame_count = 0\n        current_capture = 0\n        while cap.isOpened():\n            ret, frame = cap.read()\n            if not ret:\n                break\n            \n            # 캡처할 시간에 해당하는 프레임 캡처 및 이미지 저장\n            if frame_count == capture_frames[current_capture][0]:\n                output_path = os.path.join(output_dir, f\"frame_{capture_frames[current_capture][1]}.jpg\")\n                cv2.imwrite(output_path, frame)\n                current_capture += 1\n                if current_capture >= len(capture_frames):\n                    break\n            \n            frame_count += 1\n        \n        cap.release()\n        print(\"프레임 캡처가 완료되었습니다.\")\n\n# 비디오 파일 경로\nvideo_path = '/home/ec2-user/SageMaker/video_data/storage3.mp4'\n\n# 이미지를 저장할 디렉토리 경로\noutput_dir = 'captured_frames'\n\n# 캡처할 시간 지정 (초)\ncapture_times = [5, 35, 75, 130, 150, 170, 220, 255, 310]\n\n# 프레임 캡처 실행\ncapture_frames(video_path, output_dir, capture_times)","undoManager":{"mark":0,"position":12,"stack":[[{"start":{"row":0,"column":0},"end":{"row":50,"column":53},"action":"insert","lines":["import cv2","import os","","def capture_frames(video_path, output_dir, capture_times):","    # 비디오 파일 열기","    cap = cv2.VideoCapture(video_path)","    if not cap.isOpened():","        print(\"비디오 파일을 열 수 없습니다.\")","        return","    ","    # 캡처할 시간 지정 (초)","    capture_seconds = capture_times","    ","    # 이미지를 저장할 디렉토리 생성","    os.makedirs(output_dir, exist_ok=True)","    ","    # 캡처된 시간과 프레임 번호 저장","    capture_frames = [(int(cap.get(cv2.CAP_PROP_FPS) * sec), sec) for sec in capture_seconds]","    ","    # 프레임 캡처 및 이미지 저장","    frame_count = 0","    current_capture = 0","    while cap.isOpened():","        ret, frame = cap.read()","        if not ret:","            break","        ","        # 캡처할 시간에 해당하는 프레임 캡처 및 이미지 저장","        if frame_count == capture_frames[current_capture][0]:","            output_path = os.path.join(output_dir, f\"frame_{capture_frames[current_capture][1]}.jpg\")","            cv2.imwrite(output_path, frame)","            current_capture += 1","            if current_capture >= len(capture_frames):","                break","        ","        frame_count += 1","    ","    cap.release()","    print(\"프레임 캡처가 완료되었습니다.\")","","# 비디오 파일 경로","video_path = '/home/ec2-user/SageMaker/video_data/storage3.mp4'","","# 이미지를 저장할 디렉토리 경로","output_dir = 'captured_frames'","","# 캡처할 시간 지정 (초)","capture_times = [5, 35, 75, 130, 150, 170, 220, 255, 310]","","# 프레임 캡처 실행","capture_frames(video_path, output_dir, capture_times)"],"id":1}],[{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":2}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":12},"action":"insert","lines":["import boto3"],"id":3}],[{"start":{"row":3,"column":0},"end":{"row":4,"column":0},"action":"insert","lines":["",""],"id":4},{"start":{"row":4,"column":0},"end":{"row":4,"column":1},"action":"insert","lines":["c"]},{"start":{"row":4,"column":1},"end":{"row":4,"column":2},"action":"insert","lines":["l"]},{"start":{"row":4,"column":2},"end":{"row":4,"column":3},"action":"insert","lines":["a"]},{"start":{"row":4,"column":3},"end":{"row":4,"column":4},"action":"insert","lines":["s"]},{"start":{"row":4,"column":4},"end":{"row":4,"column":5},"action":"insert","lines":["s"]}],[{"start":{"row":4,"column":5},"end":{"row":4,"column":6},"action":"insert","lines":[" "],"id":5},{"start":{"row":4,"column":6},"end":{"row":4,"column":7},"action":"insert","lines":["S"]},{"start":{"row":4,"column":7},"end":{"row":4,"column":8},"action":"insert","lines":["#"]},{"start":{"row":4,"column":8},"end":{"row":4,"column":9},"action":"insert","lines":[":"]}],[{"start":{"row":4,"column":8},"end":{"row":4,"column":9},"action":"remove","lines":[":"],"id":6},{"start":{"row":4,"column":7},"end":{"row":4,"column":8},"action":"remove","lines":["#"]}],[{"start":{"row":4,"column":7},"end":{"row":4,"column":8},"action":"insert","lines":["3"],"id":7},{"start":{"row":4,"column":8},"end":{"row":4,"column":9},"action":"insert","lines":[":"]}],[{"start":{"row":4,"column":9},"end":{"row":4,"column":10},"action":"insert","lines":[" "],"id":8}],[{"start":{"row":5,"column":0},"end":{"row":5,"column":4},"action":"insert","lines":["    "],"id":9},{"start":{"row":6,"column":0},"end":{"row":6,"column":4},"action":"insert","lines":["    "]},{"start":{"row":7,"column":0},"end":{"row":7,"column":4},"action":"insert","lines":["    "]},{"start":{"row":8,"column":0},"end":{"row":8,"column":4},"action":"insert","lines":["    "]},{"start":{"row":9,"column":0},"end":{"row":9,"column":4},"action":"insert","lines":["    "]},{"start":{"row":10,"column":0},"end":{"row":10,"column":4},"action":"insert","lines":["    "]},{"start":{"row":11,"column":0},"end":{"row":11,"column":4},"action":"insert","lines":["    "]},{"start":{"row":12,"column":0},"end":{"row":12,"column":4},"action":"insert","lines":["    "]},{"start":{"row":13,"column":0},"end":{"row":13,"column":4},"action":"insert","lines":["    "]},{"start":{"row":14,"column":0},"end":{"row":14,"column":4},"action":"insert","lines":["    "]},{"start":{"row":15,"column":0},"end":{"row":15,"column":4},"action":"insert","lines":["    "]},{"start":{"row":16,"column":0},"end":{"row":16,"column":4},"action":"insert","lines":["    "]},{"start":{"row":17,"column":0},"end":{"row":17,"column":4},"action":"insert","lines":["    "]},{"start":{"row":18,"column":0},"end":{"row":18,"column":4},"action":"insert","lines":["    "]},{"start":{"row":19,"column":0},"end":{"row":19,"column":4},"action":"insert","lines":["    "]},{"start":{"row":20,"column":0},"end":{"row":20,"column":4},"action":"insert","lines":["    "]},{"start":{"row":21,"column":0},"end":{"row":21,"column":4},"action":"insert","lines":["    "]},{"start":{"row":22,"column":0},"end":{"row":22,"column":4},"action":"insert","lines":["    "]},{"start":{"row":23,"column":0},"end":{"row":23,"column":4},"action":"insert","lines":["    "]},{"start":{"row":24,"column":0},"end":{"row":24,"column":4},"action":"insert","lines":["    "]},{"start":{"row":25,"column":0},"end":{"row":25,"column":4},"action":"insert","lines":["    "]},{"start":{"row":26,"column":0},"end":{"row":26,"column":4},"action":"insert","lines":["    "]},{"start":{"row":27,"column":0},"end":{"row":27,"column":4},"action":"insert","lines":["    "]},{"start":{"row":28,"column":0},"end":{"row":28,"column":4},"action":"insert","lines":["    "]},{"start":{"row":29,"column":0},"end":{"row":29,"column":4},"action":"insert","lines":["    "]},{"start":{"row":30,"column":0},"end":{"row":30,"column":4},"action":"insert","lines":["    "]},{"start":{"row":31,"column":0},"end":{"row":31,"column":4},"action":"insert","lines":["    "]},{"start":{"row":32,"column":0},"end":{"row":32,"column":4},"action":"insert","lines":["    "]},{"start":{"row":33,"column":0},"end":{"row":33,"column":4},"action":"insert","lines":["    "]},{"start":{"row":34,"column":0},"end":{"row":34,"column":4},"action":"insert","lines":["    "]},{"start":{"row":35,"column":0},"end":{"row":35,"column":4},"action":"insert","lines":["    "]},{"start":{"row":36,"column":0},"end":{"row":36,"column":4},"action":"insert","lines":["    "]},{"start":{"row":37,"column":0},"end":{"row":37,"column":4},"action":"insert","lines":["    "]},{"start":{"row":38,"column":0},"end":{"row":38,"column":4},"action":"insert","lines":["    "]},{"start":{"row":39,"column":0},"end":{"row":39,"column":4},"action":"insert","lines":["    "]},{"start":{"row":40,"column":0},"end":{"row":40,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":4,"column":10},"end":{"row":5,"column":0},"action":"insert","lines":["",""],"id":10},{"start":{"row":5,"column":0},"end":{"row":5,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":5,"column":4},"end":{"row":19,"column":32},"action":"insert","lines":["def __init__(self):","        # AWS 자격 증명을 환경 변수로 설정","        self.s3_client = boto3.client(","            's3',","            aws_access_key_id=os.getenv('AWS_ACCESS_KEY_ID'),","            aws_secret_access_key=os.getenv('AWS_SECRET_ACCESS_KEY')","        )","        ","        # SageMaker 엔드포인트 URL 설정","        self.sagemaker_endpoint = 'YOUR_SAGEMAKER_ENDPOINT_NAME'","","    def stream_s3_file(self, bucket_name, file_key):","        # S3 객체를 스트리밍 방식으로 읽기","        s3_object = self.s3_client.get_object(Bucket=bucket_name, Key=file_key)","        return s3_object['Body']"],"id":11}],[{"start":{"row":19,"column":32},"end":{"row":20,"column":0},"action":"insert","lines":["",""],"id":12},{"start":{"row":20,"column":0},"end":{"row":20,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":20,"column":4},"end":{"row":20,"column":8},"action":"remove","lines":["    "],"id":13}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":8,"column":17},"end":{"row":8,"column":17},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1716480043350}